<!DOCTYPE html>
 <html>
 <head>
 <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
 <meta http-equiv="X-UA-Compatible" content="IE=7,IE=9" >
 <meta name="viewport" content="initial-scale=1, maximum-scale=1,user-scalable=no">
 <title>Basemaps</title>
 <link href="http://serverapi.arcgisonline.com/jsapi/arcgis/3.3/js/dojo/dijit/themes/claro/claro.css" rel="stylesheet" type="text/css" >
<link rel="stylesheet" href="http://serverapi.arcgisonline.com/jsapi/arcgis/3.3/js/esri/css/esri.css" />
<script src="http://serverapi.arcgisonline.com/jsapi/arcgis/3.3/" type="text/javascript"></script>
 <script type="text/javascript">
 dojo.require("esri.map");
 dojo.require("esri.layers.WebTiledLayer");

 var map;
 // Create initialization function that sets option for the map 
 function init() {
    var lat = 18,
        lng = -66,
        zoom = 9,
        layer_name = '{{layer.name|safe}}',
        map_settings = JSON.parse('{{map_settings|safe}}');
        
    if (map_settings) {
        if (map_settings.lat) {
            if (layer_name.indexOf('PR') !== -1) {
                lat = map_settings.lat - .5;   
            } else if (layer_name.indexOf('USVI') !== -1) {
                lat = map_settings.lat - .7;   
            } else {
                lat = map_settings.lat - .7;   
            }                                  
        } 
        if (map_settings.lng) {
            if (layer_name.indexOf('PR') !== -1) {
                lng = map_settings.lng + .3;   
            } else if (layer_name.indexOf('USVI') !== -1) {
                lng = map_settings.lng + 1.7;
            } else {
                lng = map_settings.lng + .8;   
            }  
        }
        if (map_settings.zoom) {
            if (layer_name.indexOf('PR') !== -1) {
                zoom = map_settings.zoom - 1;
            } else if (layer_name.indexOf('USVI') !== -1) {
                zoom = map_settings.zoom - 1;
            } else {
                zoom = map_settings.zoom - 2;
            }  
        }
    }

    var options = { 
        basemap: "topo",
        center: [lng, lat],
        zoom: zoom
    };
    // Create map and call Init function
    map = new esri.Map("mapDiv",options);
    var wtl = esri.layers.WebTiledLayer;
    var arctile_url = "{{arctile_url}}";
    var layer_name = "{{layer.name}}";
    var layer = new wtl(arctile_url, {
        "id": layer_name
    });
    map.addLayer(layer);
 }
 dojo.addOnLoad(init);
 </script>
 </head>
 <body>
 <div id="mapDiv" style="width: 500px">
 </div>
 </body>
 </html>